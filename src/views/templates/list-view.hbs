<div class="oa-view-controls">
  <button class="oa-view-toggle-button clickable">
    {{#if isHierarchicalView}}
      {{t "show_flat_view"}}
    {{else}}
      {{t "show_hierarchical_view"}}
    {{/if}}
  </button>
</div>

{{#if tasks.length}}
  {{#if isHierarchicalView}}
    {{!-- Vista jerÃ¡rquica (existente) --}}
    {{#each groupedTasks as |folder folderName|}}
      <div class="oa-folder-structure">
        {{> folderTemplate folder level=0}}
      </div>
    {{/each}}
  {{else}}
    {{!-- Vista plana (nueva) --}}
    {{#each flattenedTasks as |folder folderName|}}
      <div class="oa-folder-structure">
        <div class="oa-folder-group" data-folder="{{folderName}}" data-folder-path="{{folderName}}">
          <h3 class="oa-folder-name">
            <span class="oa-folder-toggle">â¯†</span>
            <span class="oa-folder-title">{{folderName}}</span>
            <span class="oa-task-count">({{folder.tasks.length}})</span>
          </h3>
          <ul class="oa-folder-tasks">
            {{#each folder.tasks}}
              <li class="oa-task-item" data-file-path="{{this.file.path}}" data-line-number="{{this.line.number}}">
                <div class="oa-task-priority">{{priorityIcon this.state.priority}}</div>
                <div class="oa-task-content">
                  <div class="oa-task-description">{{this.section.desc}}</div>
                  <div class="oa-task-metadata">
                    {{#if this.date.due}}
                      <span class="oa-task-due-date">ðŸ“… {{formatDate this.date.due}}</span>
                    {{/if}}
                    <span class="oa-task-path">ðŸ“„ {{this.file.path}}</span>
                  </div>
                </div>
              </li>
            {{/each}}
          </ul>
        </div>
      </div>
    {{/each}}
  {{/if}}
{{else}}
  <p>{{t "no_tasks"}}</p>
{{/if}}

{{!-- Mantener el helper inline para la vista jerÃ¡rquica --}}
{{#*inline "folderTemplate"}}
  <div class="oa-folder-group" data-folder="{{name}}" data-folder-path="{{fullPath}}">
    <h3 class="oa-folder-name" style="padding-left: {{multiply level 15}}px;">
      <span class="oa-folder-toggle">â¯†</span>
      <span class="oa-folder-title">{{name}}</span>
      <span class="oa-task-count">({{totalTaskCount this}})</span>
    </h3>
    <ul class="oa-folder-tasks">
      {{#each tasks}}
        <li class="oa-task-item" data-file-path="{{this.file.path}}" data-line-number="{{this.line.number}}">
          <div class="oa-task-priority">{{priorityIcon this.state.priority}}</div>
          <div class="oa-task-content">
            <div class="oa-task-description">{{this.section.desc}}</div>
            <div class="oa-task-metadata">
              {{#if this.date.due}}
                <span class="oa-task-due-date">ðŸ“… {{formatDate this.date.due}}</span>
              {{/if}}
              <span class="oa-task-path">ðŸ“„ {{this.file.path}}</span>
            </div>
          </div>
        </li>
      {{/each}}
    </ul>
    
    {{#if subfolders}}
      <div class="oa-subfolders-container">
        {{#each subfolders as |subfolder subfolderName|}}
          {{> folderTemplate subfolder level=(add level 1)}}
        {{/each}}
      </div>
    {{/if}}
  </div>
{{/inline}}

