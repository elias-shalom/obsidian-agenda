<div class="table-view-container">
  <div class="table-toolbar">

    <div class="table-filters">
            <select id="table-priority-filter" class="table-filter-dropdown">
        <option value="all">{{t 'all_priorities'}}</option>
        <option value="Highest">{{t 'highest_priority'}} üî∫</option>
        <option value="High">{{t 'high_priority'}} ‚è´</option>
        <option value="Medium">{{t 'medium_priority'}} üîº</option>
        <option value="Normal">{{t 'normal_priority'}} ‚ñ∂Ô∏è</option>
        <option value="Low">{{t 'low_priority'}} üîΩ</option>
        <option value="Lowest">{{t 'lowest_priority'}} ‚è¨</option>
        <option value="none">{{t 'no_priority'}}</option>
      </select>

      <select id="table-status-filter" class="table-filter-dropdown">
        <option value="all">{{t 'all_tasks'}}</option>
        <option value="Todo">{{t 'status_todo'}}</option>
        <option value="InProgress">{{t 'status_in_progress'}}</option>
        <option value="Done">{{t 'status_done'}}</option>
        <option value="Cancelled">{{t 'status_cancelled'}}</option>
        <option value="nonTask">{{t 'status_non_task'}}</option>
      </select>

      <select id="table-folder-filter" class="table-filter-dropdown">
        <option value="all">{{t 'all_folders'}}</option>
        {{#each uniqueFolders}}
        <option value="{{this}}">{{this}}</option>
        {{/each}}
      </select>

      <select id="table-due-filter" class="table-filter-dropdown">
        <option value="all">{{t 'all_dates'}}</option>
        <option value="hasdate">{{t 'has_any_date'}}</option>
        <option value="overdue">{{t 'overdue'}}</option>
        <option value="today">{{t 'due_today'}}</option>
        <option value="thisweek">{{t 'due_this_week'}}</option>
        <option value="future">{{t 'future_tasks'}}</option>
        <option value="nodate">{{t 'no_date'}}</option>
      </select>
    </div>

    <div class="table-search">
      <input type="text" id="table-search-input" placeholder="{{t 'search_tasks'}}" class="search-input">
      <button id="table-search-clear" class="search-clear-button">√ó</button>
    </div>

  </div>
  
  <div class="table-container">
    <table class="tasks-table">
      <thead>
        <tr>
          <th class="table-col-row-number">
            <span id="total-row-count"></span>
          </th>
          <th class="table-col-priority sortable" data-sort="priority">
            <span class="sort-indicator">{{t 'priority'}}</span>
          </th>
          <th class="table-col-status sortable" data-sort="status">
            <span class="sort-indicator">{{t 'status'}}</span>
          </th>          
          <th class="table-col-task sortable" data-sort="description">
            <span class="sort-indicator">{{t 'task'}}</span>
          </th>
          <th class="table-col-folder sortable" data-sort="folder">
            <span class="sort-indicator">{{t 'folder'}}</span>
          </th>
          <th class="table-col-file sortable" data-sort="file">
            <span class="sort-indicator">{{t 'file'}}</span>
          </th>
          <th class="table-col-due sortable" data-sort="due">
            <span class="sort-indicator">{{t 'dates'}}</span>
          </th>
          <th class="table-col-tags sortable" data-sort="tags">
            <span class="sort-indicator">{{t 'tags'}}</span>
          </th>
        </tr>
      </thead>
      <tbody>
        {{#each tasks}}
        <tr class="task-row {{#if completed}}task-completed{{/if}} {{priorityClass}}" data-file-path="{{this.filePath}}" data-line-number="{{lineNumber}}">
          <td class="table-col-row-number">
            <span class="row-number"></span>
          </td>
          <td class="table-col-priority">
              {{#if priority}}
              <div class="task-priority priority-{{priority}}" title="{{t priority}}">
                {{priorityIcon priority}}
              </div>
              {{else}}
              <div class="task-priority priority-none" title="{{t 'none'}}">
                {{priorityIcon "none"}}
              </div>
              {{/if}}
          </td>
          <td class="table-col-status">
            <div class="task-status-icon" title="{{t statusText}}" data-task-id="{{id}}">
              <span class="status-icon" data-status="{{statusText}}">{{statusIcon}}</span>
            </div>
          </td>
          <td class="table-col-task">
            <div class="task-description">{{description}}</div>
            {{#if subtasks}}
            <div class="task-subtasks-indicator">
              <span class="subtasks-count">{{subtasksCompletedCount}}/{{subtasksCount}}</span>
              <div class="subtasks-progress-bar">
                <div class="progress-fill" style="width: {{subtasksCompletionPercentage}}%"></div>
              </div>
            </div>
            {{/if}}
          </td>
          <td class="table-col-folder">
            <div class="task-folder">
              <span class="folder-icon">üìÅ</span>
              <span class="folder-name">{{rootFolder}}</span>
            </div>
          </td>
          <td class="table-col-file">
            <div class="task-file">
              <span class="file-icon">üìÑ</span>
              <span class="file-name">{{fileBasename}}</span>
            </div>
          </td>
          <td class="table-col-due {{#if isOverdue}}overdue{{/if}} {{#if isDueToday}}due-today{{/if}}">
            <div class="task-dates">
              {{#if dueDate}}
              <div class="task-date due-date" title="{{t 'due_date'}}">
                <span class="date-icon">{{dateTypeIcon 'Due'}}</span>
                <span class="date-text">{{formatDate dueDate}}</span>
              </div>
              {{/if}}

              {{#if scheduledDate}}
              <div class="task-date scheduled-date" title="{{t 'scheduled_date'}}">
                <span class="date-icon">{{dateTypeIcon 'Scheduled'}}</span>
                <span class="date-text">{{formatDate scheduledDate}}</span>
              </div>
              {{/if}}
              
              {{#if createdDate}}
              <div class="task-date created-date" title="{{t 'created_date'}}">
                <span class="date-icon">{{dateTypeIcon 'Created'}}</span>
                <span class="date-text">{{formatDate createdDate}}</span>
              </div>
              {{/if}}
              
              {{#if startDate}}
              <div class="task-date start-date" title="{{t 'start_date'}}">
                <span class="date-icon">{{dateTypeIcon 'Start'}}</span>
                <span class="date-text">{{formatDate startDate}}</span>
              </div>
              {{/if}}
              
              {{#if doneDate}}
              <div class="task-date done-date" title="{{t 'done_date'}}">
                <span class="date-icon">{{dateTypeIcon 'Done'}}</span>
                <span class="date-text">{{formatDate doneDate}}</span>
              </div>
              {{/if}}
              
              {{#if cancelledDate}}
              <div class="task-date cancelled-date" title="{{t 'cancelled_date'}}">
                <span class="date-icon">{{dateTypeIcon 'Cancelled'}}</span>
                <span class="date-text">{{formatDate cancelledDate}}</span>
              </div>
              {{/if}}
            </div>
          </td>
          <td class="table-col-tags">
            <div class="task-tags">
              {{#each tags}}
              <span class="task-tag">{{this}}</span>
              {{/each}}
            </div>
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
  
  {{#unless tasks.length}}
  <div class="empty-table-message">
    <p>{{t 'no_tasks_match_filters'}}</p>
  </div>
  {{/unless}}
</div>