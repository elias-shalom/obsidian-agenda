<div class="oa-table-view-container">
  <div class="oa-table-toolbar">

    <div class="oa-table-filters">
            <select id="oa-table-priority-filter" class="oa-table-filter-dropdown">
        <option value="all">{{t 'all_priorities'}}</option>
        <option value="Highest">{{t 'highest_priority'}} üî∫</option>
        <option value="High">{{t 'high_priority'}} ‚è´</option>
        <option value="Medium">{{t 'medium_priority'}} üîº</option>
        <option value="Normal">{{t 'normal_priority'}} ‚ñ∂Ô∏è</option>
        <option value="Low">{{t 'low_priority'}} üîΩ</option>
        <option value="Lowest">{{t 'lowest_priority'}} ‚è¨</option>
        <option value="none">{{t 'no_priority'}}</option>
      </select>

      <select id="oa-table-status-filter" class="oa-table-filter-dropdown">
        <option value="all">{{t 'all_tasks'}}</option>
        <option value="Todo">{{t 'status_todo'}}</option>
        <option value="InProgress">{{t 'status_in_progress'}}</option>
        <option value="Done">{{t 'status_done'}}</option>
        <option value="Cancelled">{{t 'status_cancelled'}}</option>
        <option value="nonTask">{{t 'status_non_task'}}</option>
      </select>

      <select id="oa-table-folder-filter" class="oa-table-filter-dropdown">
        <option value="all">{{t 'all_folders'}}</option>
        {{#each uniqueFolders}}
        <option value="{{this}}">{{this}}</option>
        {{/each}}
      </select>

      <select id="oa-table-due-filter" class="oa-table-filter-dropdown">
        <option value="all">{{t 'all_dates'}}</option>
        <option value="hasdate">{{t 'has_any_date'}}</option>
        <option value="overdue">{{t 'overdue'}}</option>
        <option value="today">{{t 'due_today'}}</option>
        <option value="thisweek">{{t 'due_this_week'}}</option>
        <option value="future">{{t 'future_tasks'}}</option>
        <option value="nodate">{{t 'no_date'}}</option>
      </select>
    </div>

    <div class="oa-table-search">
      <input type="text" id="oa-table-search-input" placeholder="{{t 'search_tasks'}}" class="oa-search-input">
      <button id="oa-table-search-clear" class="oa-search-clear-button">√ó</button>
    </div>

  </div>
  
  <div class="oa-table-container">
    <table class="oa-tasks-table">
      <thead>
        <tr>
          <th class="oa-table-col-row-number">
            <span id="oa-total-row-count"></span>
          </th>
          <th class="oa-table-col-priority oa-sortable" data-sort="priority">
            <span class="oa-sort-indicator">{{t 'priority'}}</span>
          </th>
          <th class="oa-table-col-status oa-sortable" data-sort="status">
            <span class="oa-sort-indicator">{{t 'status'}}</span>
          </th>          
          <th class="oa-table-col-task oa-sortable" data-sort="description">
            <span class="oa-sort-indicator">{{t 'task'}}</span>
          </th>
          <th class="oa-table-col-folder oa-sortable" data-sort="folder">
            <span class="oa-sort-indicator">{{t 'folder'}}</span>
          </th>
          <th class="oa-table-col-file oa-sortable" data-sort="file">
            <span class="oa-sort-indicator">{{t 'file'}}</span>
          </th>
          <th class="oa-table-col-due oa-sortable" data-sort="due">
            <span class="oa-sort-indicator">{{t 'dates'}}</span>
          </th>
          <th class="oa-table-col-tags oa-sortable" data-sort="tags">
            <span class="oa-sort-indicator">{{t 'tags'}}</span>
          </th>
        </tr>
      </thead>
      <tbody>
        {{#each tasks}}
        <tr class="oa-task-row {{#if completed}}oa-task-completed{{/if}} {{priorityClass}}" data-file-path="{{this.file.path}}" data-line-number="{{line.number}}">
          <td class="oa-table-col-row-number">
            <span class="oa-row-number"></span>
          </td>
          <td class="oa-table-col-priority">
              {{#if state.priority}}
              <div class="oa-task-priority priority-{{state.priority}}" title="{{t state.priority}}">
                {{priorityIcon state.priority}}
              </div>
              {{else}}
              <div class="oa-task-priority priority-none" title="{{t 'none'}}">
                {{priorityIcon "none"}}
              </div>
              {{/if}}
          </td>
          <td class="oa-table-col-status">
            <div class="oa-task-status-icon" title="{{t state.text}}" data-task-id="{{id}}">
              <span class="oa-status-icon" data-status="{{state.text}}">{{state.icon}}</span>
            </div>
          </td>
          <td class="oa-table-col-task">
            <div class="oa-task-description">{{section.desc}}</div>
            {{#if subtasks}}
            <div class="oa-task-subtasks-indicator">
              <span class="oa-subtasks-count">{{subtasksCompletedCount}}/{{subtasksCount}}</span>
              <div class="oa-subtasks-progress-bar">
                <div class="oa-progress-fill" style="width: {{subtasksCompletionPercentage}}%"></div>
              </div>
            </div>
            {{/if}}
          </td>
          <td class="oa-table-col-folder">
            <div class="oa-task-folder">
              <span class="oa-folder-icon">üìÅ</span>
              <span class="oa-folder-name">{{file.root}}</span>
            </div>
          </td>
          <td class="oa-table-col-file">
            <div class="oa-task-file">
              <span class="oa-file-icon">üìÑ</span>
              <span class="oa-file-name">{{file.basename}}</span>
            </div>
          </td>
          <td class="oa-table-col-due {{#if isOverdue}}oa-overdue{{/if}} {{#if isDueToday}}oa-due-today{{/if}}">
            <div class="oa-task-dates">
              {{#if date.due}}
              <div class="oa-task-date due-date" title="{{t 'due_date'}}">
                <span class="oa-date-icon">{{dateTypeIcon 'Due'}}</span>
                <span class="oa-date-text">{{formatDate date.due}}</span>
              </div>
              {{/if}}

              {{#if date.scheduled}}
              <div class="oa-task-date scheduled-date" title="{{t 'scheduled_date'}}">
                <span class="oa-date-icon">{{dateTypeIcon 'Scheduled'}}</span>
                <span class="oa-date-text">{{formatDate date.scheduled}}</span>
              </div>
              {{/if}}
              
              {{#if date.created}}
              <div class="oa-task-date created-date" title="{{t 'created_date'}}">
                <span class="oa-date-icon">{{dateTypeIcon 'Created'}}</span>
                <span class="oa-date-text">{{formatDate date.created}}</span>
              </div>
              {{/if}}
              
              {{#if date.start}}
              <div class="oa-task-date start-date" title="{{t 'start_date'}}">
                <span class="oa-date-icon">{{dateTypeIcon 'Start'}}</span>
                <span class="oa-date-text">{{formatDate date.start}}</span>
              </div>
              {{/if}}
              
              {{#if date.done}}
              <div class="oa-task-date done-date" title="{{t 'done_date'}}">
                <span class="oa-date-icon">{{dateTypeIcon 'Done'}}</span>
                <span class="oa-date-text">{{formatDate date.done}}</span>
              </div>
              {{/if}}
              
              {{#if date.cancelled}}
              <div class="oa-task-date cancelled-date" title="{{t 'cancelled_date'}}">
                <span class="oa-date-icon">{{dateTypeIcon 'Cancelled'}}</span>
                <span class="oa-date-text">{{formatDate date.cancelled}}</span>
              </div>
              {{/if}}
            </div>
          </td>
          <td class="oa-table-col-tags">
            <div class="oa-task-tags">
              {{#each section.tags}}
              <span class="oa-task-tag">{{this}}</span>
              {{/each}}
            </div>
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
  
  {{#unless tasks.length}}
  <div class="oa-empty-table-message">
    <p>{{t 'no_tasks_match_filters'}}</p>
  </div>
  {{/unless}}
</div>

